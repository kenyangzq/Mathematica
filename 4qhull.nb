(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 10.3' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[     15366,        490]
NotebookOptionsPosition[     14216,        451]
NotebookOutlinePosition[     14570,        467]
CellTagsIndexPosition[     14527,        464]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{

Cell[CellGroupData[{
Cell["Routines 4 d", "Section"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"VFP", "[", "VFPdata_", "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "VFstart", ",", "VFend", ",", " ", "Vstart", ",", " ", "Vend", ",", 
        " ", "Fstart", ",", " ", "Fend", ",", "numPts", ",", "numFacets", ",",
         "dim", ",", " ", "VertFacets", ",", "Verts", ",", "Facets", ",", 
        "numNN"}], "}"}], ",", "\n", 
      RowBox[{
       RowBox[{"numPts", "=", 
        RowBox[{"VFPdata", "[", 
         RowBox[{"[", 
          RowBox[{"1", ",", "1"}], "]"}], "]"}]}], ";", "\n", 
       RowBox[{"VFstart", "=", "2"}], ";", 
       RowBox[{"VFend", "=", 
        RowBox[{"numPts", "+", "1"}]}], ";", "\n", 
       RowBox[{"dim", "=", 
        RowBox[{"VFPdata", "[", 
         RowBox[{"[", 
          RowBox[{
           RowBox[{"VFend", "+", "1"}], ",", "1"}], "]"}], "]"}]}], ";", "\n", 
       RowBox[{"VertFacets", "=", " ", 
        RowBox[{"Map", "[", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"Drop", "[", 
             RowBox[{"#", ",", "1"}], "]"}], "+", "1"}], "&"}], ",", 
          RowBox[{"VFPdata", "[", 
           RowBox[{"[", 
            RowBox[{"VFstart", ";;", "VFend"}], "]"}], "]"}]}], "]"}]}], ";", 
       "\n", 
       RowBox[{"numNN", "=", " ", 
        RowBox[{"Map", "[", " ", 
         RowBox[{
          RowBox[{
           RowBox[{"#", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "&"}], ",", 
          RowBox[{"VFPdata", "[", 
           RowBox[{"[", 
            RowBox[{"VFstart", ";;", "VFend"}], "]"}], "]"}]}], "]"}]}], ";", 
       "\n", 
       RowBox[{"Vstart", "=", 
        RowBox[{"VFend", "+", "3"}]}], ";", "\n", " ", 
       RowBox[{"Vend", "=", 
        RowBox[{"Vstart", "+", "numPts", "-", "1"}]}], ";", "\n", 
       RowBox[{"numFacets", "=", 
        RowBox[{"VFPdata", "[", 
         RowBox[{"[", 
          RowBox[{
           RowBox[{"Vend", "+", "1"}], ",", "1"}], "]"}], "]"}]}], ";", "\n", 
       
       RowBox[{"Verts", "=", 
        RowBox[{"VFPdata", "[", 
         RowBox[{"[", 
          RowBox[{"Vstart", ";;", "Vend"}], "]"}], "]"}]}], ";", "\n", 
       RowBox[{"Fstart", "=", 
        RowBox[{"Vend", "+", "2"}]}], ";", "\n", 
       RowBox[{"Fend", "=", 
        RowBox[{"Fstart", "+", 
         RowBox[{"VFPdata", "[", 
          RowBox[{"[", 
           RowBox[{
            RowBox[{"Vend", "+", "1"}], ",", "1"}], "]"}], "]"}], "-", 
         "1"}]}], ";", "\n", 
       RowBox[{"Facets", "=", 
        RowBox[{"Map", "[", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"Drop", "[", 
             RowBox[{"#", ",", "1"}], "]"}], "+", "1"}], "&"}], ",", 
          RowBox[{"VFPdata", "[", 
           RowBox[{"[", 
            RowBox[{"Fstart", ";;", "Fend"}], "]"}], "]"}]}], "]"}]}], ";", 
       "\n", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"dim", ",", " ", "numPts", ",", "numFacets"}], "}"}], ",", 
         "numNN", ",", "VertFacets", ",", "Verts", ",", "Facets"}], "}"}]}]}],
      "]"}]}], ";"}], "\n"}]], "Input"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"GetVertFacets", "[", "VFPfile_", "]"}], ":=", 
  RowBox[{"VFPfile", "[", 
   RowBox[{"[", "3", "]"}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{"GetVerts", "[", "VFPfile_", "]"}], ":=", 
  RowBox[{"VFPfile", "[", 
   RowBox[{"[", "4", "]"}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{"GetFacets", "[", "VFPfile_", "]"}], ":=", 
  RowBox[{"VFPfile", "[", 
   RowBox[{"[", "5", "]"}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{"GetnumNN", "[", "VFPfile_", "]"}], ":=", 
  RowBox[{"VFPfile", "[", 
   RowBox[{"[", "2", "]"}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{"NumVerts", "[", "VFPfile_", "]"}], ":=", " ", 
  RowBox[{"Length", "[", 
   RowBox[{"VFPfile", "[", 
    RowBox[{"[", "4", "]"}], "]"}], "]"}]}], "\n"}], "Input"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"ClearAll", "[", "CircCenter4", "]"}], ";"}], "\n", 
 RowBox[{
  RowBox[{"CircCenter4", "[", 
   RowBox[{"{", 
    RowBox[{"x1_", ",", "x2_", ",", "x3_", ",", "x4_"}], "}"}], "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", "normal", "}"}], ",", "\n", 
    RowBox[{
     RowBox[{"normal", " ", "=", " ", 
      RowBox[{
       RowBox[{"NullSpace", "[", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"x2", "-", "x1"}], ",", 
          RowBox[{"x3", "-", "x1"}], ",", 
          RowBox[{"x4", "-", "x1"}]}], "}"}], "]"}], "[", 
       RowBox[{"[", "1", "]"}], "]"}]}], ";", "\n", 
     RowBox[{"LinearSolve", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"x2", "-", "x1"}], ",", 
         RowBox[{"x3", "-", "x1"}], ",", 
         RowBox[{"x4", "-", "x1"}], ",", "normal"}], "}"}], ",", "\n", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{"x2", "-", "x1"}], ")"}], ".", 
           RowBox[{"(", 
            RowBox[{"x1", "+", "x2"}], ")"}]}], "/", "2"}], ",", "\n", 
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{"x3", "-", "x1"}], ")"}], ".", 
           RowBox[{"(", 
            RowBox[{"x1", "+", "x3"}], ")"}]}], "/", "2"}], ",", "\n", 
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{"x4", "-", "x1"}], ")"}], ".", 
           RowBox[{"(", 
            RowBox[{"x1", "+", "x4"}], ")"}]}], "/", "2"}], ",", "\n", 
         RowBox[{"x1", ".", "normal"}]}], "}"}]}], "]"}]}]}], "\n", 
   "]"}]}]}], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{"VorCell4", "[", 
   RowBox[{"VFPfile_", ",", "ptIndex_"}], "]"}], ":=", 
  RowBox[{"Module", "[", "\n", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"VorVerts", ",", "theFacets"}], "}"}], ",", "\n", 
    RowBox[{
     RowBox[{"theFacets", "=", 
      RowBox[{
       RowBox[{"GetFacets", "[", "VFPfile", "]"}], "[", 
       RowBox[{"[", 
        RowBox[{
         RowBox[{"GetVertFacets", "[", "VFPfile", "]"}], "[", 
         RowBox[{"[", "ptIndex", "]"}], "]"}], "]"}], "]"}]}], ";", "\n", 
     RowBox[{"Map", "[", 
      RowBox[{"CircCenter4", ",", 
       RowBox[{"Partition", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"GetVerts", "[", "VFPfile", "]"}], "[", 
          RowBox[{"[", 
           RowBox[{"Flatten", "[", "theFacets", "]"}], "]"}], "]"}], ",", 
         "4"}], "]"}]}], " ", "]"}]}]}], "\n", "]"}]}]], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"projectTangentPlane", "[", 
    RowBox[{"TangentPoint_", ",", " ", "ProjectedPoint_"}], "]"}], ":=", " ", 
   "\n", 
   RowBox[{"ProjectedPoint", "+", 
    RowBox[{
     RowBox[{"(", 
      RowBox[{"1", "-", 
       RowBox[{"ProjectedPoint", ".", "TangentPoint"}]}], ")"}], 
     "TangentPoint"}]}]}], ";"}]], "Code"],

Cell[BoxData[
 RowBox[{
  RowBox[{"VorCell4Flat", "[", 
   RowBox[{"VFPfile_", ",", "ptIndex_"}], "]"}], ":=", " ", 
  RowBox[{"Module", "[", "\n", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "FlatCoords", ",", "VorVerts", ",", "theFacets", ",", "thePoint", ",", 
      "TangentPlane", ",", "VorCell4Points"}], "}"}], ",", "\n", 
    RowBox[{
     RowBox[{"thePoint", " ", "=", " ", 
      RowBox[{
       RowBox[{"GetVerts", "[", "VFPfile", "]"}], "[", 
       RowBox[{"[", "ptIndex", "]"}], "]"}]}], ";", "\n", 
     RowBox[{"theFacets", "=", 
      RowBox[{
       RowBox[{"GetFacets", "[", "VFPfile", "]"}], "[", 
       RowBox[{"[", 
        RowBox[{
         RowBox[{"GetVertFacets", "[", "VFPfile", "]"}], "[", 
         RowBox[{"[", "ptIndex", "]"}], "]"}], "]"}], "]"}]}], ";", "\n", 
     RowBox[{"VorCell4Points", " ", "=", " ", 
      RowBox[{"Map", "[", 
       RowBox[{"CircCenter4", ",", 
        RowBox[{"Partition", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"GetVerts", "[", "VFPfile", "]"}], "[", 
           RowBox[{"[", 
            RowBox[{"Flatten", "[", "theFacets", "]"}], "]"}], "]"}], ",", 
          "4"}], "]"}]}], " ", "]"}]}], ";", "\n", 
     RowBox[{"TangentPlane", " ", "=", " ", 
      RowBox[{"NullSpace", "[", 
       RowBox[{"{", "thePoint", "}"}], "]"}]}], ";", "\n", 
     RowBox[{"FlatCoords", " ", "=", 
      RowBox[{"Map", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"LeastSquares", "[", 
          RowBox[{
           RowBox[{"Transpose", "[", "TangentPlane", "]"}], ",", 
           RowBox[{
            RowBox[{"projectTangentPlane", "[", 
             RowBox[{"thePoint", ",", "#"}], "]"}], "-", "thePoint"}]}], 
          "]"}], "&"}], ",", "VorCell4Points"}], "]"}]}]}]}], "\n", 
   "]"}]}]], "Input"],

Cell[BoxData[{
 RowBox[{"ClearAll", "[", "plotTest", "]"}], "\n", 
 RowBox[{
  RowBox[{"plotTest", "[", "file_", "]"}], ":=", " ", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "}"}], ",", "\n", 
    RowBox[{"Graphics3D", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{"Sphere", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"0", ",", "0", ",", "0"}], "}"}], ",", ".99"}], "]"}], 
         ","}], "*)"}], 
       RowBox[{"Red", ",", 
        RowBox[{"Map", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Sphere", "[", 
            RowBox[{"#", ",", ".02"}], "]"}], "&"}], ",", "file"}], "]"}], 
        ","}], "}"}], ",", 
      RowBox[{"Lighting", "->", "\"\<Neutral\>\""}], ",", 
      RowBox[{"Axes", "->", "True"}], ",", 
      RowBox[{"Boxed", "->", "False"}], ",", 
      RowBox[{"AxesStyle", "->", 
       RowBox[{"Directive", "[", 
        RowBox[{
         RowBox[{"GrayLevel", "[", "0", "]"}], ",", 
         RowBox[{"AbsoluteThickness", "[", "1.625`", "]"}]}], "]"}]}], ",", 
      " ", "\n", 
      RowBox[{"AxesLabel", "->", 
       RowBox[{"{", 
        RowBox[{"x", ",", "y", ",", "z"}], "}"}]}], ",", 
      RowBox[{"ViewPoint", "->", 
       RowBox[{"{", 
        RowBox[{"1.3", ",", " ", 
         RowBox[{"-", "2.4"}], ",", " ", "2."}], "}"}]}]}], "]"}]}], "\n", 
   "]"}]}]}], "Code"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Plotting multiple files", "Section"],

Cell[BoxData[{
 RowBox[{"NotebookDirectory", "[", "]"}], "\n", 
 RowBox[{" ", 
  RowBox[{
   RowBox[{"path", " ", "=", " ", 
    RowBox[{"StringJoin", "[", " ", 
     RowBox[{
      RowBox[{"ParentDirectory", "[", 
       RowBox[{"NotebookDirectory", "[", "]"}], "]"}], ",", 
      "\"\</qhull120pts4d/\>\""}], "]"}]}], ";", " ", 
   RowBox[{"allFiles", " ", "=", " ", 
    RowBox[{"FileNames", "[", 
     RowBox[{"\"\<*.out\>\"", ",", "path"}], "]"}]}], ";"}]}]}], "Input"],

Cell[BoxData["paths"], "Code"],

Cell["paths"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"paths", " ", "=", " ", 
   RowBox[{"Table", "[", " ", 
    RowBox[{
     RowBox[{"allFiles", "[", 
      RowBox[{"[", "i", "]"}], "]"}], ",", " ", 
     RowBox[{"{", 
      RowBox[{"i", ",", " ", 
       RowBox[{"Length", "[", "allFiles", "]"}]}], "}"}]}], "]"}]}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{"ALLFiles", "=", " ", 
   RowBox[{"Table", "[", " ", 
    RowBox[{
     RowBox[{"Import", "[", 
      RowBox[{
       RowBox[{"paths", "[", 
        RowBox[{"[", "i", "]"}], "]"}], ",", "\"\<Table\>\""}], "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", 
       RowBox[{"Length", "[", "paths", "]"}]}], "}"}]}], "]"}]}], 
  ";"}]}], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{"ALLVFP", " ", "=", " ", 
   RowBox[{"Map", "[", 
    RowBox[{"VFP", ",", "ALLFiles"}], "]"}]}], ";"}]], "Input"],

Cell[BoxData[
 RowBox[{"Position", "[", 
  RowBox[{
   RowBox[{"GetnumNN", "[", 
    RowBox[{"ALLVFP", "[", 
     RowBox[{"[", 
      RowBox[{"-", "1"}], "]"}], "]"}], "]"}], ",", "24"}], "]"}]], "Input"],

Cell[BoxData[
 RowBox[{"Histogram", "[", 
  RowBox[{
   RowBox[{"GetnumNN", "[", 
    RowBox[{"ALLVFP", "[", 
     RowBox[{"[", 
      RowBox[{"-", "1"}], "]"}], "]"}], "]"}], ",", "10"}], "]"}]], "Input"],

Cell[BoxData[
 RowBox[{"VorCell4", "[", 
  RowBox[{
   RowBox[{"ALLVFP", "[", 
    RowBox[{"[", 
     RowBox[{"-", "1"}], "]"}], "]"}], ",", "21"}], "]"}]], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{"GetVerts", "[", 
   RowBox[{"ALLVFP", "[", 
    RowBox[{"[", 
     RowBox[{"-", "1"}], "]"}], "]"}], "]"}], "[", 
  RowBox[{"[", "21", "]"}], "]"}]], "Input"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{"VorCell4Flat", "[", 
   RowBox[{
    RowBox[{"ALLVFP", "[", 
     RowBox[{"[", 
      RowBox[{"-", "1"}], "]"}], "]"}], ",", "21"}], "]"}], "*)"}]], "Code"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{"VorCell4Flat", "[", 
   RowBox[{
    RowBox[{"ALLVFP", "[", 
     RowBox[{"[", 
      RowBox[{"-", "1"}], "]"}], "]"}], ",", "21"}], "]"}], "*)"}]], "Code"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{"Table", "[", 
   RowBox[{
    RowBox[{"plotTest", "[", 
     RowBox[{"VorCell4Flat", "[", 
      RowBox[{
       RowBox[{"ALLVFP", "[", 
        RowBox[{"[", 
         RowBox[{"-", "1"}], "]"}], "]"}], ",", "i"}], "]"}], "]"}], ",", 
    RowBox[{"{", 
     RowBox[{"i", ",", 
      RowBox[{"Length", "[", 
       RowBox[{"GetVerts", "[", 
        RowBox[{"ALLVFP", "[", 
         RowBox[{"[", 
          RowBox[{"-", "1"}], "]"}], "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
  "*)"}]], "Code"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{"plotTest", "[", 
    RowBox[{"VorCell4Flat", "[", 
     RowBox[{
      RowBox[{"ALLVFP", "[", 
       RowBox[{"[", "1", "]"}], "]"}], ",", "1"}], "]"}], "]"}], "*)"}], "\n",
   "\n", 
  RowBox[{
   RowBox[{"ConvexHullMesh", "[", 
    RowBox[{"VorCell4Flat", "[", 
     RowBox[{
      RowBox[{"ALLVFP", "[", 
       RowBox[{"[", "1", "]"}], "]"}], ",", "1"}], "]"}], "]"}], 
   "\n"}]}]], "Code"]
}, Open  ]]
},
WindowSize->{808, 655},
WindowMargins->{{4, Automatic}, {Automatic, 4}},
FrontEndVersion->"10.3 for Mac OS X x86 (32-bit, 64-bit Kernel) (October 9, \
2015)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[CellGroupData[{
Cell[580, 22, 31, 0, 64, "Section"],
Cell[614, 24, 3134, 86, 326, "Input"],
Cell[3751, 112, 740, 21, 135, "Input"],
Cell[4494, 135, 1651, 48, 182, "Input"],
Cell[6148, 185, 880, 24, 113, "Input"],
Cell[7031, 211, 364, 11, 72, "Code"],
Cell[7398, 224, 1788, 46, 218, "Input"],
Cell[9189, 272, 1403, 40, 127, "Code"]
}, Open  ]],
Cell[CellGroupData[{
Cell[10629, 317, 42, 0, 64, "Section"],
Cell[10674, 319, 474, 12, 69, "Input"],
Cell[11151, 333, 30, 0, 51, "Code"],
Cell[11184, 335, 13, 0, 20, InheritFromParent],
Cell[11200, 337, 687, 22, 54, "Input"],
Cell[11890, 361, 147, 4, 33, "Input"],
Cell[12040, 367, 204, 6, 30, "Input"],
Cell[12247, 375, 205, 6, 31, "Input"],
Cell[12455, 383, 165, 5, 30, "Input"],
Cell[12623, 390, 193, 6, 30, "Input"],
Cell[12819, 398, 197, 6, 52, "Code"],
Cell[13019, 406, 197, 6, 52, "Code"],
Cell[13219, 414, 530, 17, 53, "Code"],
Cell[13752, 433, 448, 15, 104, "Code"]
}, Open  ]]
}
]
*)

(* End of internal cache information *)

